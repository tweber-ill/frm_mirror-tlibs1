thread_func(a)
{
	i = 0;
	while(i less 25)
	{
		begin_critical(mtx);
			print("In " + a +  ": " + i);
		end_critical(mtx);

		i += 1;
	}
}

main()
{
	global mtx = mutex();

	nthreads = thread_hwcount();
	nthreads *= 2;
	print("Hardware supports " + thread_hwcount() + " threads.\n");

	th = vec(nthreads);

	i = 0;
	while(i less nthreads)
	{
		str = "thread " + (i+1);
		th[i] = thread("thread_func", str);
		i = i+1;
	}

	print("In main thread");
	join(th);
	print("In main thread -- end");
}
